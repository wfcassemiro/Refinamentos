<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Modal - Editar Palestra</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; left: 0; 
            width: 100%; height: 100%; 
            background: rgba(0,0,0,0.5); 
            z-index: 1000;
        }
        .modal-content { 
            background: white; 
            margin: 50px auto; 
            padding: 20px; 
            width: 80%; 
            max-width: 500px; 
            border-radius: 8px;
        }
        .btn { 
            background: #007cba; 
            color: white; 
            padding: 10px 15px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px;
        }
        .btn:hover { background: #005a8b; }
        .form-group { margin: 15px 0; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group textarea { 
            width: 100%; 
            padding: 8px; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
        }
        #console { 
            background: #f0f0f0; 
            padding: 10px; 
            margin: 20px 0; 
            border-radius: 4px; 
            max-height: 200px; 
            overflow-y: auto; 
            font-family: monospace; 
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üß™ Teste do Modal - Editar Palestras</h1>
    
    <div>
        <h2>Bot√µes de Teste:</h2>
        <button class="btn" onclick="testEditLecture('115faa0d55024b9b9670b82c4c7f9ad4')">
            üìù Testar Edi√ß√£o (ID Real)
        </button>
        <button class="btn" onclick="testEditLecture('default-1')">
            üéØ Testar Palestra Padr√£o
        </button>
        <button class="btn" onclick="openAddLectureModal()">
            ‚ûï Testar Adicionar Nova
        </button>
    </div>

    <div id="console">
        <strong>üìã Console de Debug:</strong><br>
    </div>

    <!-- Modal de Palestra -->
    <div id="lectureModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">Editar Palestra</h2>
            <form id="lectureForm">
                <input type="hidden" id="lectureId" name="lectureId">
                
                <div class="form-group">
                    <label for="lectureTitle">T√≠tulo:</label>
                    <input type="text" id="lectureTitle" name="lectureTitle" required>
                </div>
                
                <div class="form-group">
                    <label for="lectureSpeaker">Palestrante:</label>
                    <input type="text" id="lectureSpeaker" name="lectureSpeaker" required>
                </div>
                
                <div class="form-group">
                    <label for="lectureDate">Data:</label>
                    <input type="date" id="lectureDate" name="lectureDate" required>
                </div>
                
                <div class="form-group">
                    <label for="lectureTime">Hor√°rio:</label>
                    <input type="time" id="lectureTime" name="lectureTime" value="19:00">
                </div>
                
                <div class="form-group">
                    <label for="lectureSummary">Descri√ß√£o:</label>
                    <textarea id="lectureSummary" name="lectureSummary" rows="4" required></textarea>
                </div>
                
                <div>
                    <button type="submit" class="btn">üíæ Salvar</button>
                    <button type="button" class="btn" onclick="closeModal()">‚ùå Fechar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Fun√ß√£o para log no console visual
        function log(message) {
            const console = document.getElementById('console');
            const timestamp = new Date().toLocaleTimeString();
            console.innerHTML += `<br>[${timestamp}] ${message}`;
            console.scrollTop = console.scrollHeight;
        }

        // Fun√ß√£o de exemplo para dados padr√£o
        function getDefaultLectureData(lectureId) {
            log(`üìã Obtendo dados padr√£o para: ${lectureId}`);
            return {
                title: 'Palestra de Exemplo',
                speaker: 'Palestrante Exemplo',
                lecture_date: '2024-12-31',
                lecture_time: '19:00',
                description: 'Descri√ß√£o de exemplo para a palestra.'
            };
        }

        // Fun√ß√£o para popular o formul√°rio
        function populateLectureForm(data) {
            log(`üìù Populando formul√°rio com dados: ${JSON.stringify(data)}`);
            document.getElementById('lectureTitle').value = data.title || '';
            document.getElementById('lectureSpeaker').value = data.speaker || '';
            document.getElementById('lectureDate').value = data.lecture_date || '';
            document.getElementById('lectureTime').value = data.lecture_time || '19:00';
            document.getElementById('lectureSummary').value = data.description || '';
        }

        // Fun√ß√£o principal de teste
        function testEditLecture(lectureId) {
            log(`üß™ Iniciando teste editLecture com ID: ${lectureId}`);
            
            try {
                document.getElementById('modalTitle').textContent = 'Editar Palestra';
                document.getElementById('lectureId').value = lectureId;
                
                // Se for uma palestra padr√£o
                if (lectureId.startsWith('default-')) {
                    log(`‚ö° Palestra padr√£o detectada`);
                    const lectureData = getDefaultLectureData(lectureId);
                    populateLectureForm(lectureData);
                    document.getElementById('lectureModal').style.display = 'flex';
                    log(`‚úÖ Modal aberto para palestra padr√£o`);
                    return;
                }
                
                // Buscar dados da API
                log(`üåê Fazendo requisi√ß√£o para: manage_announcements_with_logs.php?id=${lectureId}`);
                
                fetch(`manage_announcements_with_logs.php?id=${lectureId}`)
                    .then(response => {
                        log(`üì° Resposta recebida: ${response.status} ${response.statusText}`);
                        if (!response.ok) throw new Error('Falha ao carregar dados da palestra.');
                        return response.json();
                    })
                    .then(data => {
                        log(`üìä Dados recebidos: ${JSON.stringify(data)}`);
                        populateLectureForm(data);
                        document.getElementById('lectureModal').style.display = 'flex';
                        log(`‚úÖ Modal aberto com sucesso!`);
                    })
                    .catch(error => {
                        log(`‚ùå Erro: ${error.message}`);
                        alert(`Erro ao carregar dados da palestra: ${error.message}`);
                    });
                    
            } catch (error) {
                log(`üí• Erro cr√≠tico: ${error.message}`);
                alert(`Erro cr√≠tico: ${error.message}`);
            }
        }

        function openAddLectureModal() {
            log(`‚ûï Abrindo modal para adicionar nova palestra`);
            document.getElementById('modalTitle').textContent = 'Adicionar Nova Palestra';
            document.getElementById('lectureForm').reset();
            document.getElementById('lectureId').value = '';
            document.getElementById('lectureModal').style.display = 'flex';
            log(`‚úÖ Modal de adi√ß√£o aberto`);
        }

        function closeModal() {
            log(`‚ùå Fechando modal`);
            document.getElementById('lectureModal').style.display = 'none';
        }

        // Fechar modal ao clicar fora
        document.getElementById('lectureModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Log inicial
        log(`üöÄ P√°gina de teste carregada`);
        log(`üìã Elementos verificados:`);
        log(`- Modal: ${!!document.getElementById('lectureModal')}`);
        log(`- Form: ${!!document.getElementById('lectureForm')}`);
        log(`- T√≠tulo: ${!!document.getElementById('modalTitle')}`);
    </script>
</body>
</html>